sap.ui.define(["../BaseController","sap/ui/core/Fragment"],function(e,t){"use strict";return e.extend("com.myorg.myUI5App.controller.user.CurrentUser",{onBeforeRendering:function(){this._setDefault()},_setDefault:function(){this.onFCLOneColumn();const e=this.getView();e.setModel(new sap.ui.model.json.JSONModel,"user");e.setModel(new sap.ui.model.json.JSONModel,"collections");this._userModel=e.getModel("user");this._collectionsModel=e.getModel("collections");this.getUser();this.getRoleCollections()},getUser:function(){this.callSDK("GET","/app/users/currentUser",undefined,this.setUser)},getRoleCollections:function(){this.callSDK("GET","/app/group",undefined,this.setRoleCollections)},setUser:function(e,t){this._userModel.setProperty("/",e);this.csrfToken=t.getResponseHeader("X-CSRF-Token")},setRoleCollections:function(e){this._collectionsModel.setProperty("/",e)},onAddUserRoleCollection:function(e){let t=e.getParameter("selectedItems");let o=t.map(e=>e.getTitle());let s=this._userModel.getProperty("/id");o.forEach(e=>{let t={id:e,group:{type:"USER",value:s,origin:"sap.default"}};this.callSDK("POST","/app/group",t,this.getUser)})},onOpenDialog:function(){let e=this._collectionsModel.getProperty("/resources");let o=this._userModel.getProperty("/groups");let s=e.filter(e=>{let t=o.findIndex(t=>e.id===t.value);if(t>-1)return false;return true});this._collectionsModel.setProperty("/resources",s);const l=this.getView();if(!this.oDialog){this.oDialog=t.load({name:`com.myorg.myUI5App.view.user.dialog.RoleCollectionsDialog`,controller:this})}this.oDialog.then(e=>{l.addDependent(e);e.open()})},onClose:function(){this.oDialog.then(e=>e.close())},onDeleteUserRole:async function(e){let t=e.getParameter("listItem");let o=await this.showWarningBox();let s={groupId:t.getTitle(),userId:this._userModel.getProperty("/id")};if(o){this.callSDK("DELETE","/app/group",s,this.getUser)}},onCreateUserRole:function(e){let t=e.getParameter("selectedItems");let o=t.map(e=>e.getTitle());let s=this._userModel.getProperty("/id");o.forEach(e=>{let t={id:e,group:{type:"USER",value:s,origin:"sap.default"}};this.callSDK("POST","/app/group",t,this.getUser)})}})});