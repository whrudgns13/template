sap.ui.define(["../BaseController","sap/ui/core/Fragment","sap/m/MessageBox"],function(e,t,s){"use strict";return e.extend("com.myorg.myUI5App.controller.user.Users",{onInit:function(){this._setDefault()},getUserObj:function(){return{userName:"",name:{familyName:"",givenName:""},emails:[{type:"string",value:"",primary:true}],origin:"sap.default",schemas:["urn:scim:schemas:core:1.0"],phoneNumbers:[{value:""}]}},_setDefault:function(){const e=this.getView();const t=new sap.ui.model.json.JSONModel({user:this.getUserObj(),userState:"edit"});const s=new sap.ui.model.json.JSONModel;e.setModel(t,"user");e.setModel(s,"roles");this._userModel=e.getModel("user");this._rolesModel=e.getModel("roles");this._FCL=this.getView().byId("fcl");this.callSDK("GET");this.callSDK("GET",{},"/app/group")},onUserItemPress:function(e){const t=e.getParameter("listItem");const s=t.getBindingContextPath("user");const o=JSON.parse(JSON.stringify(this._userModel.getProperty(s)));this._userModel.setProperty("/user",o);this._userPath=s;this._FCL.getLayout()==="OneColumn"?this.onFCLTwoColumn():""},onSubmit:function(){if(!this.validationCheck())return;const e=this._userModel.getProperty("/user");const t=this._userModel.getProperty("/userState");e.userName=`${e.name.familyName} ${e.name.givenName}`;t==="create"?this.saveUser():this.editUser()},saveUser:function(){const e=this._userModel.getProperty("/user");e.displayName="displayName test";this.callSDK("POST",e);this.onClose()},editUser:function(){const e=this._userModel.getProperty("/user");this.callSDK("PUT",e);this.onClose()},deleteUser:async function(){const e=this;const t=this._userModel.getProperty("/user/id");const s=await this.showWarningBox();if(s){this.callSDK("DELETE",{id:t})}},onDeleteUserRole:async function(e){const t=e.getParameter("listItem");const s=await this.showWarningBox();const o={groupId:t.getTitle(),userId:this._userModel.getProperty("/user/id")};if(s){this.callSDK("DELETE",o,"/app/group")}},onCreateUserRole:function(e){const t=e.getParameter("selectedItems");const s=t.map(e=>e.getTitle());const o=this._userModel.getProperty("/user/id");s.forEach(e=>{const t={id:e,group:{type:"USER",value:o,origin:"sap.default"}};this.callSDK("POST",t,"/app/group")})},onOpenDialog:function(e){const s=this.getCustomDataKey(e.getSource());const o=this.getCustomDataValue(e.getSource());this._dialogName=s;switch(o){case"Create":this._userModel.setProperty("/user",this.getUserObj());this._userModel.setProperty("/userState","create");this._FCL.getLayout()!=="OneColumn"?this.onFCLOneColumn():"";break;case"Edit":this._userModel.setProperty("/userState","edit");break;case"addRole":let e=this._rolesModel.getProperty("/resources");let t=this._userModel.getProperty("/user/groups");const s=e.filter(e=>{const s=t.findIndex(t=>e.id===t.value);if(s>-1)return false;return true});this._rolesModel.setProperty("/resources",s);break}const r=this.getView();if(!this[s]){this[s]=t.load({name:`com.myorg.myUI5App.view.user.${s}`,controller:this})}this[s].then(e=>{r.addDependent(e);e.open()})},onRoleSearch:function(e){const t=e.getParameter("value");const s=new sap.ui.model.Filter("id","Contains",t);const o=e.getParameter("itemsBinding");o.filter([s])},onClose:function(){const e=this._dialogName;this[e].then(e=>e.close())},getCustomDataKey(e){const t=e.getCustomData()[0].getKey();return t},getCustomDataValue(e){const t=e.getCustomData()[0].getValue();return t}})});